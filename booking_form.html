<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Drive Smart Car Booking Form</title>
    
    <link rel="stylesheet" type="text/css" href="css/jquery-gallery.css">
    <link href="https://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon.ico">
	<link href="https://fonts.googleapis.com/css?family=PT+Sans:400" rel="stylesheet">
	<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />

	<link type="text/css" rel ="stylesheet" href = "css/styles.css">
	<link type="text/css" rel="stylesheet" href="css/style.css" />

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script>
        $(document).ready(function () {	
			$('#bookingForm').fadeIn(1500, function () {});
        });
    </script>

	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
		  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	

</head>

<body>
	<nav>
        <div class ="logo"> 
            <a class="navbar-brand mr-4 nav-item nav-link" href="index.html">
                <img src="images/logo1.jpg" alt="A1 Telecom" width="120" height="90">
                </a>
       </div>
        <label for ="btn" class ="icon">
            <span class ="fa fa-bars"></span>
        </label>
        <div class="right"> 
			<h4 class="welcome" id="welcome_msg"></h4>
			<br>
			<ul style="z-index: 1000;">
				<li>
					<a href ="#">Book Vehicle</a>
					<ul>
						<li><a href ="car.html">Car</a></li>
						<li><a href ="suv.html">SUV</a></li>
						<li><a href ="van.html">Van</a></li>         
					</ul>     
				</li>
				<li>
					<a href = "/booking_form.html">Manage Bookings</a>
				</li>
				<li><a href ="Aboutus.html">About Us</a></li>
				<li><a href ="Contactus.html">Contact Us</a></li>
				<li><a href ="SignIn.html">SIGN IN / JOIN</a></li>
			</ul>
		</div>
    </nav>

	<div id="booking" class="section">
		<div class="section-center">
			<button id="toggle" class="btn btn-primary">Toggle View Form</button>
			<div id="content" class="container">
				<div class="row">
					<span class="text-red" id="booking_msg"></span>
					<div id="bookingForm" class="booking-form" style="display: none;">
						<form>
							<div class="row" >
								<div id="ref" class="col-md-12" style="display: none;">
									<div class="form-group">
										<span class="form-label">Booking Reference</span>
										<input id="bookingref" class="form-control" type="text" placeholder="Booking reference" >
									</div>
							</div>
							<div id="bookingDetails">
								<div class="row">
									<div class="col-md-6">
										<div class="form-group">
											<span class="form-label">Full Name</span>
											<input id="fullname" class="form-control" type="text" placeholder="Full Name" disabled>
										</div>
									</div>
									<div class="col-md-6">
										<div class="form-group">
											<span class="form-label">Car Name</span>
											<input id="carName" class="form-control" type="text" placeholder="Car name" disabled>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-4">
										<div class="form-group">
											<span class="form-label">Pick-up</span>
											<input id="pickup_date" class="form-control date_picker" type="date" disabled>
										</div>
									</div>
									<div class="col-md-4">
										<div class="form-group">
											<span class="form-label">Return</span>
											<!-- <p id="final">Total Cost is :$</p> -->
											<input id="return_date" class="form-control date_picker" type="date" disabled>
										</div>
									</div>
									<div id="costdiv" class="col-md-4">
										<div class="form-group">
											<span class="form-label">Cost</span>
											<input id="cost" class="form-control" type="text" disabled>
										</div>
									</div>
<!--  -->
									<div id=finaldiv class="col-md-4" style="display: none;">
										<div class="form-group">
											<span class="form-label">Cost</span>
											<input id="final" class="form-control" type="text" disabled>
										</div>
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-md-12">
									<div class="col-md-2"></div>
									<div id="viewBookingbtn" class="col-md-8">
										<div class="form-btn">
											<input type="button" class="submit-btn" value="View Booking" onclick="viewBooking()"/>
										</div>
									</div>
								</div>

								<div class="col-md-12">
									<div id="modifyBookingbtn" class="col-md-6">
										<div class="form-btn">
											<input type="button" class="submit-btn" onclick="modifyBooking()" value="Change Dates"/>
										</div>
									</div>
									<div id="saveBookingbtn" class="col-md-6">
										<div class="form-btn">
											<input type="submit" class="submit-btn" onclick="saveBooking()" value="Save Changes"/>
										</div>
									</div>
									<div id="cancelBookingbtn" class="col-md-6">
										<div class="form-btn">
											<button class="submit-btn" onclick="cancelBooking()">Cancel Booking</button>
										</div>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

<script>
	$(document).ready(function(){
		var fullname = sessionStorage.getItem('fullname');
		if(fullname != undefined || fullname != ""){
		$('#welcome_msg').html('Welcome ' + fullname);
		}
	});
</script>

<script>
$(document).ready(function(){
	$("#toggle").click(function(){
	$("#content").toggle(1000);
	});
});
</script>

<!-- <script>
    var booking_data = [{"12345qwerty":{booking_reference: "12345qwerty", fullname: "Mike Brown", pickup_date: new Date("2021-05-25").toISOString().slice(0, 10), hour: "2", minute: "00", am_pm: "PM", return_date: new Date("2021-05-31").toISOString().slice(0, 10)}},
						{"54321asdfgh":{booking_reference: "54321asdfgh", fullname: "Jane Richard", pickup_date: new Date("2021-04-17").toISOString().slice(0, 10), hour: "10", minute: "30", am_pm: "AM", return_date: new Date("2021-04-20").toISOString().slice(0, 10)}}
	];
</script> -->

<script>
	
	function viewBooking() {
		$('#booking_msg').html('');
		booked_car_data=JSON.parse(sessionStorage.getItem("booked_cardata"));
		if (booked_car_data){
			$("#bookingDetails").show(1500);
			document.getElementById("bookingref").value = booked_car_data["bookingref"];
			$('#bookingref').prop('disabled', true);
			document.getElementById("fullname").value = booked_car_data["fullName"];
			document.getElementById("carName").value = booked_car_data["carName"];
			document.getElementById("final").value = booked_car_data["finalCost"];
			document.getElementById("cost").value = booked_car_data["finalCost"];
			document.getElementById("pickup_date").value = new Date(booked_car_data["pickupDate"]).toISOString().slice(0, 10);
			document.getElementById("return_date").value = new Date(booked_car_data["dropoffDate"]).toISOString().slice(0, 10);
			debugger;
			document.getElementById("booking").style.backgroundImage = "url("+booked_car_data['carImage']+")";
			// document.getElementById("booking").style.backgroundImage = "url(images/car-kia.jpg)";
			console.log(booked_car_data["carImage"]);

			document.getElementById("viewBookingbtn").style.display = "none";
			document.getElementById("ref").style.display = "inline";
			document.getElementById("modifyBookingbtn").style.display = "inline";
			document.getElementById("cancelBookingbtn").style.display = "inline";
		}
		else{
			$('#booking_msg').html('No Booking found!!')
		}	
	}

	function modifyBooking() {
		$('#booking_msg').html('');
		$('#pickup_date').prop('disabled', false);
		$('#return_date').prop('disabled', false);
		document.getElementById("modifyBookingbtn").style.display = "none";
		document.getElementById("saveBookingbtn").style.display = "inline";
	}
	$('.date_picker').on('change',function(){
			debugger;
			car_data=JSON.parse(sessionStorage.getItem("current_booking_cardata"));
			pickup=$('#pickup_date').val();
			dropoff=$('#return_date').val();
			if(pickup!=undefined && pickup!=null && pickup!="" && dropoff!=undefined && dropoff!=null && dropoff!=""){
			
				pickup_date=new Date(pickup);
				dropoff_date=new Date(dropoff);
				if(pickup_date<dropoff_date){
					//str1=pickup_date.split('-');
					// str2=dropoff_date.split('-');
					// t1=new Date(str1[2],str1[1],str1[0]);
					// t2=new Date(str2[2],str2[1],str2[0]);
					// pickup_date=new Date($('#pickup_date').val());
					// dropoff_date=new Date($('#dropoff_date').val());
					t1=pickup_date.getTime();
					t2=dropoff_date.getTime();
					var diff1=Math.abs(t2-t1);
					var millisecondsInADay = (1000 * 3600 * 24);
					var diffindays=diff1/millisecondsInADay;
					var week_quot=0;
					var week_rem=0;
					
					var week=7;
					
					
					if(diffindays<7){
						
						rate=car_data["dailyrate"];
					}
					else if(diffindays<30){
						debugger;
						
						diff=Math.floor(diffindays/week);
						rem=diffindays % week;
						rate =(car_data["weeklyrate"]*diff)+(rem*car_data["dailyrate"]);
					}
					else{
						debugger;
						
						diff=Math.floor(diffindays/30);
						rem_month=diffindays%30;
						if(rem_month>7){
							week_quot=Math.floor(rem_month/7);
							week_rem=rem_month%week;

						}
						else{
							week_rem=rem_month%week;

						}
						

						
						rate=(car_data["monthlyrate"]*diff)+(car_data["weeklyrate"]*week_quot)+(week_rem*car_data["dailyrate"]);
						debugger;
					}
				}

					cost=(rate).toFixed(2);
					final= cost;
					debugger;
					document.getElementById("costdiv").style.display = "none";
					document.getElementById("finaldiv").style.display = "inline";
					document.getElementById('final').value=final;
			}
		});

	function saveBooking() {
		booked_car_data=JSON.parse(sessionStorage.getItem("booked_cardata"));
		debugger;
		$('#booking_msg').html('');
		var pickupDate = new Date($('#pickup_date').val());
		var dropoffDate = new Date($('#return_date').val());
		var bookingref = $('#bookingref').val();
		var carName = $('#carName').val();
		var fullName = $('#fullname').val();
		var final = $('#final').val();
		var carImage = booked_car_data['carImage']
debugger;
		var booked_car_data = {bookingref:bookingref, fullName:fullName, carName:carName, pickupDate:pickupDate, dropoffDate:dropoffDate,finalCost:final, carImage:carImage};
		sessionStorage.setItem('booked_cardata', JSON.stringify(booked_car_data));

		document.getElementById("booking_msg").style.color = "green";
		$('#booking_msg').html('Booking Modified!')
	}

	function cancelBooking() {
		$('#booking_msg').html('');
		sessionStorage.clear();
		document.getElementById("booking_msg").style.color = "red";
		$('#booking_msg').html('Booking Cancelled!')
	}
</script>

</body>


</html>
	